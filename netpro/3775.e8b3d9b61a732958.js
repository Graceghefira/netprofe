"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[3775],{53775:(A,d,s)=>{s.r(d),s.d(d,{default:()=>B});var l=s(60177),h=s(88834),g=s(99213),v=s(96695),F=s(49192),x=s(31849),$=s(9159),O=s(22080),c=s(84412),I=s(21413),w=s(84572),N=s(56977),G=s(96354),f=s(44549),t=s(54438),u=s(10467),S=s(51373),m=s(77502),b=s(95084),y=s(45794);let R=(()=>{class e{constructor(){this.apiUrl=m.c.apiUrl,this.toast=(0,t.WQX)(y.tw),this._NetproNetwach=new c.t([]),this.netpro$=this._NetproNetwach.asObservable(),this._ImagoNetwach=new c.t([]),this.imago$=this._ImagoNetwach.asObservable(),this._WowNetwach=new c.t([]),this.Wow$=this._WowNetwach.asObservable(),this.initMqtt()}initMqtt(){this.client=b.A.connect("wss://netpro.awh.co.id:8083/mqtt",{username:m.c.mqtt.username,password:m.c.mqtt.password}),this.client.on("connect",()=>{console.log("MQTT connected"),this.client.subscribe("Netpro/netwatch-status",n=>{n&&(console.error("Failed to subscribe:",n),this.toast.error(n.message,"Error Subscribing"))}),this.client.subscribe("imago/netwatch-status",n=>{n&&(console.error("Failed to subscribe:",n),this.toast.error(n.message,"Error Subscribing"))}),this.client.subscribe("Wow/netwatch-status",n=>{n&&(console.error("Failed to subscribe:",n),this.toast.error(n.message,"Error Subscribing"))})}),this.client.on("message",(n,i)=>{"Netpro/netwatch-status"===n?this.handleMessage(i.toString(),this._NetproNetwach):"imago/netwatch-status"===n?this.handleMessage(i.toString(),this._ImagoNetwach):"Wow/netwatch-status"===n&&this.handleMessage(i.toString(),this._WowNetwach)}),this.client.on("close",()=>{console.warn("MQTT connection closed, attempting to reconnect..."),setTimeout(()=>{this.client.reconnect()},1e3)})}handleMessage(n,i){try{const a=JSON.parse(n);i.next(a)}catch(a){console.error("Error parsing message:",a),this.toast.error("Invalid data received","Error")}}get(n){var i=this;return(0,u.A)(function*(){return yield S.A.get(i.apiUrl+"/api/"+n).then(function(){var a=(0,u.A)(function*(r){return r.data});return function(r){return a.apply(this,arguments)}}()).catch(function(){var a=(0,u.A)(function*(r){return console.log(r),r});return function(r){return a.apply(this,arguments)}}())})()}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=t.jDH({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var T=s(32209);const j=()=>[1,2];function C(e,o){1&e&&t.nrm(0,"ion-skeleton-text",9),2&e&&t.Y8G("animated",!0)}function Y(e,o){if(1&e&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&e){const n=t.XpG().$implicit;t.R7$(),t.JRh(n.type)}}function E(e,o){1&e&&t.nrm(0,"ion-skeleton-text",10),2&e&&t.Y8G("animated",!0)}function k(e,o){if(1&e&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&e){const n=t.XpG().$implicit;t.R7$(),t.SpI(" Board Name : ","Netpro"===n.type?"RB450Gx4":"Imago"===n.type?"RB951Ui-2nD":"-----"," ")}}function D(e,o){if(1&e&&(t.j41(0,"li",12)(1,"p"),t.nrm(2,"ion-skeleton-text",13),t.k0s(),t.j41(3,"p"),t.nrm(4,"ion-skeleton-text",13),t.k0s(),t.j41(5,"p"),t.nrm(6,"ion-skeleton-text",13),t.k0s(),t.j41(7,"p"),t.nrm(8,"ion-skeleton-text",13),t.k0s()()),2&e){const n=t.XpG(3);t.Y8G("ngClass",0===n.i?"":"pt-5 flex flex-col"),t.R7$(2),t.Y8G("animated",!0),t.R7$(2),t.Y8G("animated",!0),t.R7$(2),t.Y8G("animated",!0),t.R7$(2),t.Y8G("animated",!0)}}function L(e,o){1&e&&(t.j41(0,"ul"),t.DNE(1,D,9,5,"li",11),t.k0s()),2&e&&(t.R7$(),t.Y8G("ngForOf",t.lJ4(1,j)))}function M(e,o){if(1&e&&(t.j41(0,"li",12)(1,"p"),t.EFF(2),t.k0s(),t.j41(3,"p"),t.EFF(4),t.k0s(),t.j41(5,"p"),t.EFF(6),t.k0s(),t.j41(7,"p"),t.EFF(8),t.k0s()()),2&e){const n=o.$implicit,i=o.index;t.Y8G("ngClass",0===i?"":"pt-5"),t.R7$(2),t.Lme("",0===i?"Main":"Backup"," : ",null==n?null:n.host,""),t.R7$(2),t.SpI("Status : ",null==n?null:n.status,""),t.R7$(2),t.SpI("Timeout : ",null===(null==n?null:n.timeout)?"Not Found":null==n?null:n.timeout,""),t.R7$(2),t.SpI("Interval : ",null===(null==n?null:n.interval)?"Not Found":null==n?null:n.interval,"")}}function U(e,o){if(1&e&&(t.j41(0,"ul"),t.DNE(1,M,9,6,"li",11),t.k0s()),2&e){const n=t.XpG().$implicit;t.R7$(),t.Y8G("ngForOf",n.data)}}function W(e,o){1&e&&(t.j41(0,"div")(1,"p"),t.EFF(2,"Data tidak ditemukan."),t.k0s()())}function X(e,o){if(1&e&&(t.j41(0,"fuse-card",3)(1,"div")(2,"h1",4),t.DNE(3,C,1,1,"ion-skeleton-text",5)(4,Y,2,1,"span",6),t.k0s(),t.j41(5,"p",7),t.DNE(6,E,1,1,"ion-skeleton-text",8)(7,k,2,1,"span",6),t.k0s()(),t.DNE(8,L,2,2,"ul",6)(9,U,2,1,"ul",6)(10,W,3,0,"div",6),t.k0s()),2&e){const n=o.$implicit,i=t.XpG();t.R7$(3),t.Y8G("ngIf",i.isLoading),t.R7$(),t.Y8G("ngIf",!i.isLoading),t.R7$(2),t.Y8G("ngIf",i.isLoading),t.R7$(),t.Y8G("ngIf",!i.isLoading),t.R7$(),t.Y8G("ngIf",!i.isLoading&&!n.data),t.R7$(),t.Y8G("ngIf",!i.isLoading&&n.data),t.R7$(),t.Y8G("ngIf",i.isLoading&&!n.data)}}const B=[{path:"",component:(()=>{class e{constructor(n,i){this.failOverServices=n,this._notificationService=i,this.data$=new c.t([]),this.isLoading=!0,this.destroy$=new I.B}ngOnInit(){const n=f.c9.now();try{(0,w.z)([this.failOverServices.imago$,this.failOverServices.netpro$,this.failOverServices.Wow$]).pipe((0,N.Q)(this.destroy$)).subscribe(([i,a,r])=>{this.data$.next([{type:"Imago",data:i.netwatch},{type:"Netpro",data:a.netwatch},{type:"Wow",data:r.netwatch}])}),this._notificationService.getAll().pipe((0,G.T)(i=>i.map(a=>({...a,time:f.c9.fromISO(a.time).toRelative()})))).subscribe(i=>{this.data$.subscribe(a=>{i.find(p=>"Fail Over"===p.title)||this._notificationService.create({id:null,icon:"error",title:"Fail Over",description:"Fail Over Service is down",time:n.minus({minute:25}).toISO(),read:!1}).subscribe()})})}catch(i){console.error(i)}finally{this.isLoading=!1}}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(i){return new(i||e)(t.rXU(R),t.rXU(T.I))}}static{this.\u0275cmp=t.VBU({type:e,selectors:[["app-fail-over"]],decls:4,vars:3,consts:[[1,"p-5","mb-20","sm:mb-20","w-full"],[1,"grid","grid-cols-1","sm:grid-cols-2","md:grid-cols-3","gap-3"],["class","flex flex-col p-6 pb-4 gap-5",4,"ngFor","ngForOf"],[1,"flex","flex-col","p-6","pb-4","gap-5"],[1,"font-semibold","text-xl"],["style","width: 80px",3,"animated",4,"ngIf"],[4,"ngIf"],[1,"text-sm","font-medium","opacity-50"],["style","width: 150px",3,"animated",4,"ngIf"],[2,"width","80px",3,"animated"],[2,"width","150px",3,"animated"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[3,"animated"]],template:function(i,a){1&i&&(t.j41(0,"main",0)(1,"section",1),t.DNE(2,X,11,7,"fuse-card",2),t.nI1(3,"async"),t.k0s()()),2&i&&(t.R7$(2),t.Y8G("ngForOf",t.bMT(3,1,a.data$)))},dependencies:[g.m_,F.iI,v.Ou,h.Hl,l.MD,l.YU,l.Sq,l.bT,l.Jj,x.$,$.tP,O.ds],encapsulation:2})}}return e})()}]}}]);