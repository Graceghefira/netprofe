"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[5626],{85626:(f,l,a)=>{a.r(l),a.d(l,{default:()=>v});var o=a(54438),c=a(77502),h=a(95084);let u=(()=>{class s{constructor(){this.apiUrl=c.c.apiUrl,this.markers=new Map,this.deviceNames=new Map}initializeMap(){this.map=L.map("map",{maxZoom:18,center:[-6.957526,107.694767],zoom:7}),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"\xa9 OpenStreetMap contributors"}).addTo(this.map),setTimeout(()=>{this.map.invalidateSize()},0)}addStaticMarkers(t,e){const n=L.icon({iconUrl:e,iconSize:[35,35],popupAnchor:[0,0]});Object.entries(t).forEach(([i,{lat:r,lng:m,name:p}])=>{this.deviceNames.set(i,p);const d=L.marker([r,m],{icon:n}).addTo(this.map).bindPopup(`<b>${p}</b>.<br>CPU Load: -- %<br>RouterOS: --<br>Model: --`);this.markers.set(i,d)})}connectToMQTT(t){this.client=h.A.connect("wss://netpro.awh.co.id:8083/mqtt",{username:c.c.mqtt.username,password:c.c.mqtt.password}),this.client.on("connect",()=>{console.log("MQTT connected"),t.forEach(e=>{this.client.subscribe(e,n=>{n||console.log(`Subscribed to ${e}`)})})}),this.client.on("message",(e,n)=>{const i=JSON.parse(n.toString());this.updateCPULoad(e,i)})}updateCPULoad(t,e){const{cpuLoad:n,rosVersion:i,model:r}=e;if(this.markers.has(t)){const m=this.markers.get(t),d=`\n        <b>${this.deviceNames.get(t)||"Unknown Device"}</b>.<br>\n        CPU Load: ${n}%<br>\n        RouterOS: ${i}<br>\n        Model: ${r}\n      `;m.setPopupContent(d)}else console.warn(`Marker untuk topik ${t} tidak ditemukan.`)}removeMap(){this.map&&this.map.remove()}disconnect(){this.client&&this.client.end(!0)}static{this.\u0275fac=function(e){return new(e||s)}}static{this.\u0275prov=o.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();const v=[{path:"",component:(()=>{class s{constructor(t){this.mapService=t}ngOnInit(){this.mapService.initializeMap();const t={"mikrotik/get-device":{lat:-6.957526,lng:107.694767,name:"Gerai AWH"},"imago/get-device":{lat:-6.848968,lng:107.64727,name:"Imago"},"topic/device3":{lat:-6.248045,lng:106.52527,name:"WoW"}};this.mapService.addStaticMarkers(t,"/assets/icons/icon-location.png");const e=Object.keys(t);this.mapService.connectToMQTT(e)}ngOnDestroy(){this.mapService.disconnect()}static{this.\u0275fac=function(e){return new(e||s)(o.rXU(u))}}static{this.\u0275cmp=o.VBU({type:s,selectors:[["app-location-devices"]],decls:2,vars:0,consts:[[1,"w-full","h-full",2,"z-index","1"],["id","map"]],template:function(e,n){1&e&&(o.j41(0,"section",0),o.nrm(1,"div",1),o.k0s())},encapsulation:2})}}return s})()}]}}]);