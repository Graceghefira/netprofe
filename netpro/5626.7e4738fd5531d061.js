"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[5626],{85626:(f,d,i)=>{i.r(d),i.d(d,{default:()=>h});var n=i(54438),c=i(77502),l=i(95084);let u=(()=>{class s{constructor(){this.apiUrl=c.c.apiUrl,this.markers=new Map}initializeMap(){this.map=L.map("map",{maxZoom:18,center:[-6.957526,107.694767],zoom:7}),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"\xa9 OpenStreetMap contributors"}).addTo(this.map),setTimeout(()=>{this.map.invalidateSize()},0)}addStaticMarkers(t,e){const o=L.icon({iconUrl:e,iconSize:[50,50],popupAnchor:[0,0]});Object.entries(t).forEach(([a,{lat:r,lng:m,name:p}])=>{const v=L.marker([r,m],{icon:o}).addTo(this.map).bindPopup(`<b>${p}</b>.<br>CPU Load: -- %<br>RouterOS: --<br>Model: --`);this.markers.set(a,v)})}connectToMQTT(t){this.client=l.A.connect("wss://sysnet.awh.co.id:8083/mqtt",{username:c.c.mqtt.username,password:c.c.mqtt.password}),this.client.on("connect",()=>{console.log("MQTT connected"),t.forEach(e=>{this.client.subscribe(e,o=>{o||console.log(`Subscribed to ${e}`)})})}),this.client.on("message",(e,o)=>{const a=JSON.parse(o.toString());this.updateCPULoad(e,a)})}updateCPULoad(t,e){const{cpuLoad:o,rosVersion:a,model:r}=e;this.markers.has(t)?this.markers.get(t).setPopupContent(`\n        <b>${t}</b>.<br>\n        CPU Load: ${o}%<br>\n        RouterOS: ${a}<br>\n        Model: ${r}\n      `):console.warn(`Marker untuk topik ${t} tidak ditemukan.`)}removeMap(){this.map&&this.map.remove()}disconnect(){this.client&&this.client.end(!0)}static{this.\u0275fac=function(e){return new(e||s)}}static{this.\u0275prov=n.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();const h=[{path:"",component:(()=>{class s{constructor(t){this.mapService=t}ngOnInit(){this.mapService.initializeMap();const t={"mikrotik/get-device":{lat:-6.957526,lng:107.694767,name:"Gerai AWH"},"imago/get-device":{lat:-6.848968,lng:107.64727,name:"Imago"},"topic/device3":{lat:-6.248045,lng:106.52527,name:"WoW"}};this.mapService.addStaticMarkers(t,"/assets/icons/mikrotik.png");const e=Object.keys(t);this.mapService.connectToMQTT(e)}ngOnDestroy(){this.mapService.disconnect()}static{this.\u0275fac=function(e){return new(e||s)(n.rXU(u))}}static{this.\u0275cmp=n.VBU({type:s,selectors:[["app-location-devices"]],standalone:!0,features:[n.aNF],decls:2,vars:0,consts:[[1,"w-full","h-full"],["id","map"]],template:function(e,o){1&e&&(n.j41(0,"section",0),n.nrm(1,"div",1),n.k0s())},encapsulation:2})}}return s})()}]}}]);